
trigger: none

pool:
  vmImage: 'ubuntu-latest'

variables:
  tag: 'azuredevops-$(Build.BuildNumber)'
  imageName: 'mikebroomfield/azure-snake-dockle'
  
stages:

  - stage: Build
    jobs:
    - job: Build_Docker_Image
      steps:
      - task: Docker@2
        inputs:
          repository: 'mikebroomfield/azure-snake-dockle'
          command: 'build'
          Dockerfile: '**/Dockerfile'
          tags: '$(tag)'  

  - stage: Scan
    jobs:
    - job: Dockle_Scan
      steps:
      - template: dockle-container.yml
        parameters:
          image: $(imageName):$(tag)  